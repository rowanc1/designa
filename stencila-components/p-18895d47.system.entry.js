var __extends=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(e,t,r,n){function o(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,i){function s(e){try{u(n.next(e))}catch(t){i(t)}}function a(e){try{u(n["throw"](e))}catch(t){i(t)}}function u(e){e.done?r(e.value):o(e.value).then(s,a)}u((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;o=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1];i=s;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(s);break}if(i[2])r.ops.pop();r.trys.pop();continue}s=t.call(e,r)}catch(a){s=[6,a];o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};System.register(["./p-3c51b445.system.js","./p-1ba9f457.system.js","./p-90243427.system.js","./p-8f5b68f0.system.js","./p-470d2955.system.js"],(function(e){"use strict";var t,r,n,o,i,s,a,u,c,f,l,h;return{setters:[function(e){t=e.h;r=e.r;n=e.H},function(e){o=e.c;i=e.a;s=e.b},function(e){a=e.T;u=e.a;c=e.b},function(e){f=e.u;l=e.s},function(e){h=e._}],execute:function(){var d=this;function p(e){return e}function v(e){return function(){return e}}function m(e,t,r,n,o,i,s,a,u){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return r(t(e.apply(this,arguments)))};case 4:return function(){return n(r(t(e.apply(this,arguments))))};case 5:return function(){return o(n(r(t(e.apply(this,arguments)))))};case 6:return function(){return i(o(n(r(t(e.apply(this,arguments))))))};case 7:return function(){return s(i(o(n(r(t(e.apply(this,arguments)))))))};case 8:return function(){return a(s(i(o(n(r(t(e.apply(this,arguments))))))))};case 9:return function(){return u(a(s(i(o(n(r(t(e.apply(this,arguments)))))))))}}return}function y(e,t,r,n,o,i,s,a,u,c,f,l,h,d,p,v,m,y,b,g){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return o(n(r(t(e))));case 6:return i(o(n(r(t(e)))));case 7:return s(i(o(n(r(t(e))))));case 8:return a(s(i(o(n(r(t(e)))))));case 9:return u(a(s(i(o(n(r(t(e))))))));case 10:return c(u(a(s(i(o(n(r(t(e)))))))));case 11:return f(c(u(a(s(i(o(n(r(t(e))))))))));case 12:return l(f(c(u(a(s(i(o(n(r(t(e)))))))))));case 13:return h(l(f(c(u(a(s(i(o(n(r(t(e))))))))))));case 14:return d(h(l(f(c(u(a(s(i(o(n(r(t(e)))))))))))));case 15:return p(d(h(l(f(c(u(a(s(i(o(n(r(t(e))))))))))))));case 16:return v(p(d(h(l(f(c(u(a(s(i(o(n(r(t(e)))))))))))))));case 17:return m(v(p(d(h(l(f(c(u(a(s(i(o(n(r(t(e))))))))))))))));case 18:return y(m(v(p(d(h(l(f(c(u(a(s(i(o(n(r(t(e)))))))))))))))));case 19:return b(y(m(v(p(d(h(l(f(c(u(a(s(i(o(n(r(t(e))))))))))))))))));case 20:return g(b(y(m(v(p(d(h(l(f(c(u(a(s(i(o(n(r(t(e)))))))))))))))))))}return}var b=function(e){return e._tag==="Left"};var g=function(e){return e._tag==="Right"};var w=function(e){return{_tag:"Left",left:e}};var _=function(e){return{_tag:"Right",right:e}};function x(e,t){return function(r){return b(r)?e(r.left):t(r.right)}}function E(e){return b(e)?_(e.left):w(e.right)}var S=function(e){return function(t){return b(t)?t:_(e(t.right))}};var T=function(e,t){return function(r){return b(r)?w(e(r.left)):_(t(r.right))}};var A=function(e){return function(t){return b(t)?w(e(t.left)):t}};var C=function(e){return function(t){return b(t)?t:b(e)?e:_(t.right(e.right))}};var j=C;var P=function(e){return e._tag==="Some"};var $=function(e){return e._tag==="None"};var R={_tag:"None"};var D=function(e){return{_tag:"Some",value:e}};var O=function(e,t){return $(e)?R:D(t(e.value))};var k=function(e){return function(t){return O(t,e)}};var I="@nll/datum/Datum";var N={_tag:"Initial"};var L={_tag:"Pending"};var q=function(e){return{_tag:"Refresh",value:e}};var U=function(e){return{_tag:"Replete",value:e}};var M=v(N);var F=v(L);var B=function(e,t,r,n){return function(o){switch(o._tag){case"Initial":return e();case"Pending":return t();case"Refresh":return r(o.value);case"Replete":return n(o.value)}}};var z=function(e){return e._tag==="Initial"};var J=function(e){return e._tag==="Pending"};var H=function(e){return e._tag==="Refresh"};var W=function(e){return e._tag==="Replete"};var G=function(e){return W(e)||H(e)};var V=function(e,t){return function(r){return B(e,t,p,p)(r)}};var K=function(e,t){return B(M,F,(function(e){return q(t(e))}),(function(e){return U(t(e))}))(e)};var Y=function(e,t){return B(M,(function(){return B(M,F,F,F)(t)}),(function(e){return B(M,F,(function(t){return q(e(t))}),(function(t){return q(e(t))}))(t)}),(function(e){return B(M,F,(function(t){return q(e(t))}),(function(t){return U(e(t))}))(t)}))(e)};var X=function(e,t){return B(M,F,t,t)(e)};var Q=function(e,t,r){return B((function(){return t}),(function(){return t}),(function(e){return r(t,e)}),(function(e){return r(t,e)}))(e)};var Z=function(e){return function(t,r){return B((function(){return e.empty}),(function(){return e.empty}),r,r)(t)}};var ee=function(e,t,r){return B((function(){return t}),(function(){return t}),(function(e){return r(e,t)}),(function(e){return r(e,t)}))(e)};var te=function(e){return function(t,r){return B((function(){return e.of(N)}),(function(){return e.of(L)}),(function(t){return e.map(r(t),q)}),(function(t){return e.map(r(t),U)}))(t)}};var re=function(e){return function(t){return B((function(){return e.of(N)}),(function(){return e.of(L)}),(function(t){return e.map(t,q)}),(function(t){return e.map(t,U)}))(t)}};var ne=function(e,t){return B(t,t,q,U)(e)};var oe=function(e,t){return U(t(e))};var ie=function(e){return B(M,F,(function(e){return P(e)?q(e.value):N}),(function(e){return P(e)?U(e.value):N}))(e)};var se={left:N,right:N};var ae=function(e){var t=K(e,(function(e){return{left:b(e)?U(e.left):N,right:g(e)?U(e.right):N}}));return V((function(){return se}),(function(){return se}))(t)};var ue=function(e,t){return B(M,F,(function(r){return t(r)?e:N}),(function(r){return t(r)?e:N}))(e)};var ce=function(e,t){return ie(K(e,t))};var fe=function(e,t){return{left:ue(e,(function(e){return!t(e)})),right:ue(e,t)}};var le=function(e,t){return ae(K(e,t))};var he=function(e){return function(t,r){return B(v(e.of(N)),v(e.of(L)),(function(t){return e.map(r(t),(function(e){return P(e)?q(e.value):N}))}),(function(t){return e.map(r(t),(function(e){return P(e)?U(e.value):N}))}))(t)}};var de=function(e){return function(t,r){var n=K(t,(function(t){return e.map(r(t),(function(e){return{left:b(e)?U(e.left):N,right:g(e)?U(e.right):N}}))}));return G(n)?n.value:e.of(se)}};var pe=function(e){return N};var ve={URI:I,map:K,of:U,ap:Y,chain:X,reduce:Q,foldMap:Z,reduceRight:ee,traverse:te,sequence:re,zero:M,alt:ne,extend:oe,compact:ie,separate:ae,filter:ue,filterMap:ce,partition:fe,partitionMap:le,wither:he,wilt:de,throwError:pe};function me(e){var t=function(t){return function(r){return e.ap(e.map(r,(function(e){return function(t){return y(e,j(t))}})),t)}};var r=m(_,e.of);return{map:function(t,r){return e.map(t,S(r))},ap:function(e,r){return y(e,t(r))},of:r,chain:function(t,r){return e.chain(t,(function(t){return b(t)?e.of(w(t.left)):r(t.right)}))},alt:function(t,n){return e.chain(t,(function(e){return b(e)?n():r(e.right)}))},bimap:function(t,r,n){return e.map(t,(function(e){return y(e,T(r,n))}))},mapLeft:function(t,r){return e.map(t,(function(e){return y(e,A(r))}))},fold:function(t,r,n){return e.chain(t,x(r,n))},getOrElse:function(t,r){return e.chain(t,x(r,e.of))},orElse:function(t,n){return e.chain(t,x(n,(function(e){return r(e)})))},swap:function(t){return e.map(t,E)},rightM:function(t){return e.map(t,_)},leftM:function(t){return e.map(t,w)},left:function(t){return e.of(w(t))}}}var ye="@nll/datum/DatumEither";var be=Object.assign(Object.assign({},me(ve)),{URI:ye});var ge=function(e){return U(_(e))};var we=function(e){return U(w(e))};var _e=N;var xe=L;var Ee=function(){return _e};var Se=function(){return xe};var Te=function(e){return G(e)&&g(e.value)};var Ae=function(e){return G(e)&&b(e.value)};var Ce=function(e){return B(Se,Se,v(e),q)(e)};var je=function(e){return B(Ee,Ee,U,v(e))(e)};var Pe=function(e,t,r,n,o,i){return function(s){switch(s._tag){case"Initial":return e();case"Pending":return t();case"Refresh":return x(r,n)(s.value);case"Replete":return x(o,i)(s.value)}}};var $e=o((function(e,t){var r=function(e){function t(){this.fetch=false;this.DOMException=e.DOMException}t.prototype=e;return new t}(typeof self!=="undefined"?self:i);(function(e){var t=function(t){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{new Blob;return true}catch(Me){return false}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function n(e){return e&&DataView.prototype.isPrototypeOf(e)}if(r.arrayBuffer){var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var i=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1}}function s(e){if(typeof e!=="string"){e=String(e)}if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e)){throw new TypeError("Invalid character in header field name")}return e.toLowerCase()}function a(e){if(typeof e!=="string"){e=String(e)}return e}function u(e){var t={next:function(){var t=e.shift();return{done:t===undefined,value:t}}};if(r.iterable){t[Symbol.iterator]=function(){return t}}return t}function c(e){this.map={};if(e instanceof c){e.forEach((function(e,t){this.append(t,e)}),this)}else if(Array.isArray(e)){e.forEach((function(e){this.append(e[0],e[1])}),this)}else if(e){Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}}c.prototype.append=function(e,t){e=s(e);t=a(t);var r=this.map[e];this.map[e]=r?r+", "+t:t};c.prototype["delete"]=function(e){delete this.map[s(e)]};c.prototype.get=function(e){e=s(e);return this.has(e)?this.map[e]:null};c.prototype.has=function(e){return this.map.hasOwnProperty(s(e))};c.prototype.set=function(e,t){this.map[s(e)]=a(t)};c.prototype.forEach=function(e,t){for(var r in this.map){if(this.map.hasOwnProperty(r)){e.call(t,this.map[r],r,this)}}};c.prototype.keys=function(){var e=[];this.forEach((function(t,r){e.push(r)}));return u(e)};c.prototype.values=function(){var e=[];this.forEach((function(t){e.push(t)}));return u(e)};c.prototype.entries=function(){var e=[];this.forEach((function(t,r){e.push([r,t])}));return u(e)};if(r.iterable){c.prototype[Symbol.iterator]=c.prototype.entries}function f(e){if(e.bodyUsed){return Promise.reject(new TypeError("Already read"))}e.bodyUsed=true}function l(e){return new Promise((function(t,r){e.onload=function(){t(e.result)};e.onerror=function(){r(e.error)}}))}function h(e){var t=new FileReader;var r=l(t);t.readAsArrayBuffer(e);return r}function d(e){var t=new FileReader;var r=l(t);t.readAsText(e);return r}function p(e){var t=new Uint8Array(e);var r=new Array(t.length);for(var n=0;n<t.length;n++){r[n]=String.fromCharCode(t[n])}return r.join("")}function v(e){if(e.slice){return e.slice(0)}else{var t=new Uint8Array(e.byteLength);t.set(new Uint8Array(e));return t.buffer}}function m(){this.bodyUsed=false;this._initBody=function(e){this._bodyInit=e;if(!e){this._bodyText=""}else if(typeof e==="string"){this._bodyText=e}else if(r.blob&&Blob.prototype.isPrototypeOf(e)){this._bodyBlob=e}else if(r.formData&&FormData.prototype.isPrototypeOf(e)){this._bodyFormData=e}else if(r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)){this._bodyText=e.toString()}else if(r.arrayBuffer&&r.blob&&n(e)){this._bodyArrayBuffer=v(e.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||i(e))){this._bodyArrayBuffer=v(e)}else{this._bodyText=e=Object.prototype.toString.call(e)}if(!this.headers.get("content-type")){if(typeof e==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(r.blob){this.blob=function(){var e=f(this);if(e){return e}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return f(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(h)}}}this.text=function(){var e=f(this);if(e){return e}if(this._bodyBlob){return d(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(p(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(r.formData){this.formData=function(){return this.text().then(w)}}this.json=function(){return this.text().then(JSON.parse)};return this}var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e){var t=e.toUpperCase();return y.indexOf(t)>-1?t:e}function g(e,t){t=t||{};var r=t.body;if(e instanceof g){if(e.bodyUsed){throw new TypeError("Already read")}this.url=e.url;this.credentials=e.credentials;if(!t.headers){this.headers=new c(e.headers)}this.method=e.method;this.mode=e.mode;this.signal=e.signal;if(!r&&e._bodyInit!=null){r=e._bodyInit;e.bodyUsed=true}}else{this.url=String(e)}this.credentials=t.credentials||this.credentials||"same-origin";if(t.headers||!this.headers){this.headers=new c(t.headers)}this.method=b(t.method||this.method||"GET");this.mode=t.mode||this.mode||null;this.signal=t.signal||this.signal;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&r){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(r)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})};function w(e){var t=new FormData;e.trim().split("&").forEach((function(e){if(e){var r=e.split("=");var n=r.shift().replace(/\+/g," ");var o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}));return t}function _(e){var t=new c;var r=e.replace(/\r?\n[\t ]+/g," ");r.split(/\r?\n/).forEach((function(e){var r=e.split(":");var n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}));return t}m.call(g.prototype);function x(e,t){if(!t){t={}}this.type="default";this.status=t.status===undefined?200:t.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in t?t.statusText:"OK";this.headers=new c(t.headers);this.url=t.url||"";this._initBody(e)}m.call(x.prototype);x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})};x.error=function(){var e=new x(null,{status:0,statusText:""});e.type="error";return e};var E=[301,302,303,307,308];x.redirect=function(e,t){if(E.indexOf(t)===-1){throw new RangeError("Invalid status code")}return new x(null,{status:t,headers:{location:e}})};t.DOMException=e.DOMException;try{new t.DOMException}catch(T){t.DOMException=function(e,t){this.message=e;this.name=t;var r=Error(e);this.stack=r.stack};t.DOMException.prototype=Object.create(Error.prototype);t.DOMException.prototype.constructor=t.DOMException}function S(e,n){return new Promise((function(o,i){var s=new g(e,n);if(s.signal&&s.signal.aborted){return i(new t.DOMException("Aborted","AbortError"))}var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e={status:a.status,statusText:a.statusText,headers:_(a.getAllResponseHeaders()||"")};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t="response"in a?a.response:a.responseText;o(new x(t,e))};a.onerror=function(){i(new TypeError("Network request failed"))};a.ontimeout=function(){i(new TypeError("Network request failed"))};a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))};a.open(s.method,s.url,true);if(s.credentials==="include"){a.withCredentials=true}else if(s.credentials==="omit"){a.withCredentials=false}if("responseType"in a&&r.blob){a.responseType="blob"}s.headers.forEach((function(e,t){a.setRequestHeader(t,e)}));if(s.signal){s.signal.addEventListener("abort",u);a.onreadystatechange=function(){if(a.readyState===4){s.signal.removeEventListener("abort",u)}}}a.send(typeof s._bodyInit==="undefined"?null:s._bodyInit)}))}S.polyfill=true;if(!e.fetch){e.fetch=S;e.Headers=c;e.Request=g;e.Response=x}t.Headers=c;t.Request=g;t.Response=x;t.fetch=S;return t}({})})(r);delete r.fetch.polyfill;t=r.fetch;t.default=r.fetch;t.fetch=r.fetch;t.Headers=r.Headers;t.Request=r.Request;t.Response=r.Response;e.exports=t}));var Re=null;if(typeof WebSocket!=="undefined"){Re=WebSocket}else if(typeof MozWebSocket!=="undefined"){Re=MozWebSocket}else if(typeof i!=="undefined"){Re=i.WebSocket||i.MozWebSocket}else if(typeof window!=="undefined"){Re=window.WebSocket||window.MozWebSocket}else if(typeof self!=="undefined"){Re=self.WebSocket||self.MozWebSocket}var De=Re;var Oe=function(e){return crypto.getRandomValues(new Uint8Array(e))};var ke=function(e,t,r){var n=(2<<Math.log(e.length-1)/Math.LN2)-1;var o=-~(1.6*n*t/e.length);return function(){var i="";while(true){var s=r(o);var a=o;while(a--){i+=e[s[a]&n]||"";if(i.length===+t)return i}}}};var Ie=function(e,t){return ke(e,t,Oe)};var Ne=function(e){__extends(t,e);function t(t,r){var n=e.call(this,r)||this;n.family=t;return n}return t}(String);var Le=15e11;var qe=Ie("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",20);function Ue(e){var t=e.length===2?e:e.length===0?"uu":e.length===1?e.repeat(2):e.slice(0,2);var r=(Date.now()-Le).toString(16).padStart(10,"0");var n=qe();var o=t+"."+r+"."+n;return new Ne(t,o)}function Me(){return(Me=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Fe,Be;if("undefined"!=typeof process&&(Fe={emit:process.emit,listeners:process.listeners,addListener:process.addListener,removeListener:process.removeListener,removeAllListeners:process.removeAllListeners}),"undefined"!=typeof window){var ze=new Map;Fe={emit:function(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))},listeners:function(){return Array.from(ze.keys())},addListener:function(e,t){var r=function(e){return t(e.detail)};window.addEventListener(e,r),ze.set(t,r)},removeListener:function(e,t){var r=ze.get(t);void 0!==r&&(window.removeEventListener(e,r),ze.delete(t))},removeAllListeners:function(e){Array.from(ze.values()).map((function(t){window.removeEventListener(e,t)})),ze.clear()}}}function Je(e,t,r){var n="";"object"==typeof e&&void 0!==e.message?n=e.message:"string"==typeof e&&(n=e);var o={tag:t,level:r,message:n};if("object"==typeof e&&void 0!==e.stack)o.stack=e.stack;else if(r<=Be.error){var i=new Error;if(void 0!==i.stack){var s=i.stack.split("\n");o.stack=[s[0]].concat(s.slice(3)).join("\n")}}Fe.emit("stencila:logga",o)}function He(){return Fe.listeners("stencila:logga")}function We(e,t){void 0===t&&(t={});var r=e,n=t.tags,o=t.maxLevel,i=t.messageRegex,s=t.func;return void 0===n&&void 0===o&&void 0===i&&void 0===s||(r=function(t){(void 0===n||n.includes(t.tag))&&(void 0!==o&&t.level>o||(void 0===i||i.test(t.message))&&(void 0===s||s(t))&&e(t))}),Fe.addListener("stencila:logga",r),r}!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=2]="info",e[e.debug=3]="debug"}(Be||(Be={}));var Ge=new Map;function Ve(e,t){void 0===t&&(t={});var r=e.tag,n=e.level,o=e.message,i=e.stack,s=t.maxLevel;if(!(n>(void 0===s?Be.info:s))){var a=t.throttle;if(void 0!==a){var u=(void 0!==a.signature?a.signature:"").replace(/\${tag}/,r).replace(/\${level}/,n.toString()).replace(/\${message}/,o),c=Ge.get(u);if(void 0!==c){var f=void 0!==a.duration?a.duration:1e3;if(Date.now()-c<f)return}Ge.set(u,Date.now())}var l="";if("undefined"!=typeof process&&void 0!==process.stderr&&!0!==process.stderr.isTTY)l=JSON.stringify(Me({time:(new Date).toISOString()},e));else{var h=n<0?0:n>3?3:n,d=Be[h].toUpperCase().padEnd(5," ");l="undefined"!=typeof window?d+" "+r+" "+o:["🚨","⚠","🛈","🐛"][h]+" "+["[31;1m","[33;1m","[34;1m","[30;1m"][h]+d+"[0m [36m"+r+"[0m "+o;var p=t.showStack;void 0!==p&&p&&void 0!==i&&(l+="\n  "+i)}console.error(l)}}function Ke(e){return{error:function(t){Je(t,e,Be.error)},warn:function(t){Je(t,e,Be.warn)},info:function(t){Je(t,e,Be.info)},debug:function(t){Je(t,e,Be.debug)}}}0===He().length&&We(Ve);var Ye=function(e){return function(t){return Object.keys(e).includes(t)}},Xe=function(e){return function(t){return!!Ze(t)&&Ye(e)(t.type)}},Qe=function(e){var t,r=((t={})[e]=e,t);return Xe(r)},Ze=function(e){return null!=e&&Object.prototype.hasOwnProperty.call(e,"type")},et=Qe("Article"),tt=Qe("Paragraph"),rt=Qe("ListItem"),nt=function(e){return null===e?"Null":"boolean"==typeof e?"Boolean":"number"==typeof e?"Number":"string"==typeof e?"Text":Array.isArray(e)?"Array":Ze(e)?e.type:"Object"};var ot=function(e){__extends(t,e);function t(t){var r=e.call(this,t)||this;r.name="InternalError";return r}return t}(Error);var it=function(e){__extends(t,e);function t(t){var r=e.call(this,'Method "'+t+'" is unknown')||this;r.name="MethodUnknownError";r.method=t;return r}return t}(Error);var st=function(e){__extends(t,e);function t(t){var r=e.call(this,'Parameter "'+t+'" is required')||this;r.name="ParamRequiredError";r.param=t;return r}return t}(Error);var at=function(e){__extends(t,e);function t(r,n,o){if(r===void 0){r="Incapable"}if(o===void 0){o={}}var i=e.call(this,n!==undefined?t.message(r,n,o):r)||this;i.name="CapabilityError";return i}t.message=function(e,t,r){return e+': method "'+t+'" with params:\n'+Object.entries(r).map((function(e){var t=e[0],r=e[1];var n;if(Ze(r)){n="<"+nt(r)+">"}else{n=JSON.stringify(r);if(n!==undefined&&n.length>20){n=n.slice(0,20)+"..."}}return"  "+t+": "+n})).join("\n")};return t}(Error);var ut=Ke("executa:executor");var ct;(function(e){e["manifest"]="manifest";e["decode"]="decode";e["encode"]="encode";e["query"]="query";e["compile"]="compile";e["build"]="build";e["execute"]="execute";e["begin"]="begin";e["end"]="end";e["pipe"]="pipe";e["cancel"]="cancel"})(ct||(ct={}));var ft=function(){function e(e){if(e===void 0){e="ex"}this.id=Ue(e).toString()}e.prototype.addresses=function(){return Promise.resolve(undefined)};e.prototype.capabilities=function(){return Promise.resolve(undefined)};e.prototype.manifest=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:e={version:1,id:this.id.toString()};return[4,this.addresses()];case 1:e.addresses=t.sent();return[4,this.capabilities()];case 2:return[2,(e.capabilities=t.sent(),e)]}}))}))};e.prototype.decode=function(e,t){return this.call(ct.decode,{source:e,format:t})};e.prototype.encode=function(e,t,r){return this.call(ct.encode,{node:e,dest:t,format:r})};e.prototype.query=function(e,t,r){return this.call(ct.query,{node:e,query:t,lang:r})};e.prototype.compile=function(e){return this.call(ct.compile,{node:e})};e.prototype.build=function(e){return this.call(ct.build,{node:e})};e.prototype.execute=function(e,t,r,n){return this.call(ct.execute,{node:e,session:t,claims:r,job:n})};e.prototype.begin=function(e,t){return this.call(ct.begin,{node:e,claims:t})};e.prototype.end=function(e,t){return this.call(ct.end,{node:e,claims:t})};e.prototype.pipe=function(e,t){return this.call(ct.pipe,{node:e,calls:t})};e.prototype.cancel=function(e){return Promise.resolve(false)};e.prototype.dispatch=function(e,t){if(t===void 0){t={}}switch(e){case ct.manifest:return this.manifest();case ct.decode:return this.decode(r(0,"source"),r(1,"format",false));case ct.encode:return this.encode(r(0,"node"),r(1,"dest",false),r(2,"format",false));case ct.query:return this.query(r(0,"node"),r(1,"query"),r(1,"lang",false));case ct.compile:return this.compile(r(0,"node"));case ct.build:return this.build(r(0,"node"));case ct.execute:return this.execute(r(0,"node"),r(1,"session",false),r(2,"claims",false),r(3,"job",false));case ct.begin:return this.begin(r(0,"node"),r(1,"claims",false));case ct.end:return this.end(r(0,"node"),r(1,"claims",false));case ct.pipe:return this.pipe(r(0,"node"),r(1,"calls"));case ct.cancel:return this.cancel(r(0,"job"))}throw new it(e);function r(e,r,n){if(n===void 0){n=true}var o=t[r];if(o===undefined)o=t[e];if(n&&o===undefined)throw new st(r);return o}};e.prototype.call=function(e,t){throw new at("No capability implemented",e,t)};e.prototype.notify=function(e,t,r,n){throw new ot("Method notify should be implemented in derived classes")};e.prototype.notified=function(e,t,r){switch(e){case"debug":case"info":case"warn":case"error":ut[e](t);break;default:ut.info(t)}};e.prototype.start=function(){return Promise.resolve()};e.prototype.stop=function(){return Promise.resolve()};return e}();var lt;(function(e){e["direct"]="direct";e["stdio"]="stdio";e["pipe"]="pipe";e["uds"]="uds";e["vsock"]="vsock";e["tcp"]="tcp";e["http"]="http";e["ws"]="ws"})(lt||(lt={}));var ht=function(){function e(e,t){if(t===void 0){t={scheme:"tcp",host:"127.0.0.1",port:7e3}}this.type=lt.tcp;var r=vt(e,t),n=r.scheme,o=r.host,i=r.port;this.scheme=n;this.host=o;this.port=i}e.prototype.url=function(){return mt(this)};return e}();var dt=function(e){__extends(t,e);function t(t,r){if(r===void 0){r={scheme:"http",host:"127.0.0.1",port:80}}var n=e.call(this,t,r)||this;n.type=lt.http;var o=vt(t,r).path;n.path=o;if(typeof t==="object"){var i=t.protocol,s=t.jwt;n.protocol=i;n.jwt=s}return n}return t}(ht);var pt=function(e){__extends(t,e);function t(t){var r=e.call(this,t,{scheme:"ws",host:"127.0.0.1",port:80})||this;r.type=lt.ws;return r}return t}(dt);function vt(e,t){var r;var n=Gt({path:undefined},t),o=n.scheme,i=n.host,s=n.path;var a;if(typeof e==="string"){var u=/^[0-9]{2,5}$/.exec(e);if(u!==null){a=parseInt(u[0])}else{var c=/(([a-z]{2,5}):\/\/)?([^:/]+)(:(\d+))?(\/(.+))?$/.exec(e);if(c===null)throw new ot('Could not parse address "'+e+'"');if(c[2]!==undefined)o=c[2];if(c[3]!==undefined)i=c[3];if(c[5]!==undefined)a=parseInt(c[5]);if(c[7]!==undefined)s=c[7]}}else if(typeof e==="number"){a=e}else{r=Gt({scheme:o,host:i,port:a,path:s},e),o=r.scheme,i=r.host,a=r.port,s=r.path}if(a===undefined){if(o==="http"||o==="ws")a=80;else if(o==="https"||o==="wss")a=443;else a=t.port}return{scheme:o,host:i,port:a,path:s}}function mt(e){var t=e.scheme,r=e.host,n=e.port,o=e.path;var i=t+"://"+r;if(t==="tcp"||(t==="http"||t==="ws")&&n!==80||(t==="https"||t==="wss")&&n!==443)i+=":"+n;if(t!=="tcp"&&o!==undefined){if(!o.startsWith("/"))i+="/";i+=o}return i}var yt;(function(e){e[e["ParseError"]=-32700]="ParseError";e[e["InvalidRequest"]=-32600]="InvalidRequest";e[e["MethodNotFound"]=-32601]="MethodNotFound";e[e["InvalidParams"]=-32602]="InvalidParams";e[e["InternalError"]=-32603]="InternalError";e[e["ServerError"]=-32e3]="ServerError";e[e["CapabilityError"]=-32005]="CapabilityError"})(yt||(yt={}));var bt=function(){function e(e,t,r){this.name="JsonRpcError";this.code=e;this.message=t;this.data=r}e.fromError=function(t){if(t instanceof e){return t}if(t instanceof it){return new e(yt.MethodNotFound,'Method not found: "'+t.method+'"')}if(t instanceof st){return new e(yt.InvalidParams,'Invalid params: "'+t.param+'" is missing')}if(t instanceof at){return new e(yt.CapabilityError,t.message)}return new e(yt.ServerError,"Internal error: "+t.message,{trace:t.stack})};e.toError=function(e){var t=e.code,r=e.message;switch(t){case yt.CapabilityError:return new at(r);default:return e}};return e}();var gt=function(){function e(e,t,r){this.jsonrpc="2.0";if(r!==undefined&&r!==false){this.id=r}else if(r===undefined){this.id=Ue("re").toString()}this.method=e;this.params=t}e.create=function(t){if(typeof t==="string")return e.parse(t);if(t!==null&&typeof t==="object"&&!Array.isArray(t))return e.hydrate(t);throw new bt(yt.InvalidRequest,"Invalid request type: "+typeof t)};e.hydrate=function(t){var r=t.method,n=t.params,o=t.id;if(r===undefined)throw new bt(yt.InvalidRequest,'Invalid request: missing property: "method"');if(typeof r!=="string")throw new bt(yt.InvalidRequest,'Invalid request: incorrect type for "method": '+typeof r);return new e(r,n,o===undefined?false:o)};e.parse=function(t){var r;try{r=JSON.parse(t)}catch(n){throw new bt(yt.ParseError,"Parse error: "+n.message)}return e.hydrate(r)};return e}();var wt=Ke("executa:client");var _t=function(e){__extends(t,e);function t(t){if(t===void 0){t="cli"}var r=e.call(this,t)||this;r.requests={};r.notifications=[];r.notificationsCount=0;r.notificationsLength=1e3;return r}t.prototype.manifest=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(!(this.manifestCached===undefined))return[3,2];e=this;return[4,this.call(ct.manifest)];case 1:e.manifestCached=t.sent();t.label=2;case 2:return[2,this.manifestCached]}}))}))};t.prototype.cancel=function(e){return this.call(ct.cancel,{job:e})};t.prototype.call=function(e,t){if(t===void 0){t={}}return __awaiter(this,void 0,void 0,(function(){var r,n,o;var i=this;return __generator(this,(function(s){switch(s.label){case 0:r=new gt(e,t);n=r.id;if(n===undefined)throw new ot("Request should have id defined");o=new Promise((function(e,t){i.requests[n]={id:n,date:new Date,resolve:e,reject:t}}));return[4,this.send(r)];case 1:s.sent();return[2,o]}}))}))};t.prototype.notify=function(e,t){var r=new gt(e,{message:t},false);return this.send(r)};t.prototype.notified=function(e,t){var r=this,n=r.notifications,o=r.notificationsLength;this.notificationsCount+=1;n.push({id:this.notificationsCount,date:new Date,subject:e,message:t});if(n.length>o){n.splice(0,n.length-o)}};t.prototype.receive=function(e){if(typeof e==="string"){try{e=JSON.parse(e)}catch(f){wt.error("Error parsing message as JSON: "+e);return}}var t=e.id;if(t===undefined){var r=e.method,n=e.params,o=n===void 0?[]:n;var i=Object.values(o);return this.notified(r,i[0])}if(t.length===0){wt.error("Response is missing id: "+JSON.stringify(e));return}var s=this.requests[t];if(s===undefined){wt.error("No request found for response with id: "+t);return}var a=s.resolve,u=s.reject;var c=e.result,f=e.error;if(!(f===null||f===undefined))u(bt.toError(f));else{try{a(c)}catch(f){wt.error("Unhandled error when resolving result: "+f)}}delete this.requests[t]};t.prototype.stop=function(){for(var t=0,r=Object.values(this.requests);t<r.length;t++){var n=r[t].reject;n(new Error("Client is stopping"))}return e.prototype.stop.call(this)};return t}(ft);function xt(e,t){return t={exports:{}},e(t,t.exports),t.exports}function Et(e,t){if(typeof t==="boolean"){t={forever:t}}this._originalTimeouts=JSON.parse(JSON.stringify(e));this._timeouts=e;this._options=t||{};this._maxRetryTime=t&&t.maxRetryTime||Infinity;this._fn=null;this._errors=[];this._attempts=1;this._operationTimeout=null;this._operationTimeoutCb=null;this._timeout=null;this._operationStart=null;if(this._options.forever){this._cachedTimeouts=this._timeouts.slice(0)}}var St=Et;Et.prototype.reset=function(){this._attempts=1;this._timeouts=this._originalTimeouts};Et.prototype.stop=function(){if(this._timeout){clearTimeout(this._timeout)}this._timeouts=[];this._cachedTimeouts=null};Et.prototype.retry=function(e){if(this._timeout){clearTimeout(this._timeout)}if(!e){return false}var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime){this._errors.unshift(new Error("RetryOperation timeout occurred"));return false}this._errors.push(e);var r=this._timeouts.shift();if(r===undefined){if(this._cachedTimeouts){this._errors.splice(this._errors.length-1,this._errors.length);this._timeouts=this._cachedTimeouts.slice(0);r=this._timeouts.shift()}else{return false}}var n=this;var o=setTimeout((function(){n._attempts++;if(n._operationTimeoutCb){n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout);if(n._options.unref){n._timeout.unref()}}n._fn(n._attempts)}),r);if(this._options.unref){o.unref()}return true};Et.prototype.attempt=function(e,t){this._fn=e;if(t){if(t.timeout){this._operationTimeout=t.timeout}if(t.cb){this._operationTimeoutCb=t.cb}}var r=this;if(this._operationTimeoutCb){this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)}this._operationStart=(new Date).getTime();this._fn(this._attempts)};Et.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated");this.attempt(e)};Et.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated");this.attempt(e)};Et.prototype.start=Et.prototype.try;Et.prototype.errors=function(){return this._errors};Et.prototype.attempts=function(){return this._attempts};Et.prototype.mainError=function(){if(this._errors.length===0){return null}var e={};var t=null;var r=0;for(var n=0;n<this._errors.length;n++){var o=this._errors[n];var i=o.message;var s=(e[i]||0)+1;e[i]=s;if(s>=r){t=o;r=s}}return t};var Tt=xt((function(e,t){t.operation=function(e){var r=t.timeouts(e);return new St(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};t.timeouts=function(e){if(e instanceof Array){return[].concat(e)}var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:Infinity,randomize:false};for(var r in e){t[r]=e[r]}if(t.minTimeout>t.maxTimeout){throw new Error("minTimeout is greater than maxTimeout")}var n=[];for(var o=0;o<t.retries;o++){n.push(this.createTimeout(o,t))}if(e&&e.forever&&!n.length){n.push(this.createTimeout(o,t))}n.sort((function(e,t){return e-t}));return n};t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1;var n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));n=Math.min(n,t.maxTimeout);return n};t.wrap=function(e,r,n){if(r instanceof Array){n=r;r=null}if(!n){n=[];for(var o in e){if(typeof e[o]==="function"){n.push(o)}}}for(var i=0;i<n.length;i++){var s=n[i];var a=e[s];e[s]=function n(o){var i=t.operation(r);var s=Array.prototype.slice.call(arguments,1);var a=s.pop();s.push((function(e){if(i.retry(e)){return}if(e){arguments[0]=i.mainError()}a.apply(this,arguments)}));i.attempt((function(){o.apply(e,s)}))}.bind(e,a);e[s].options=r}}}));var At=Tt;var Ct=function(e){__extends(t,e);function t(t){var r;var n=e.call(this)||this;if(t instanceof Error){n.originalError=t;r=t,t=r.message}else{n.originalError=new Error(t);n.originalError.stack=n.stack}n.name="AbortError";n.message=t;return n}return t}(Error);var jt=function(e,t,r){var n=r.retries-(t-1);e.attemptNumber=t;e.retriesLeft=n;return e};var Pt=function(e,t){return new Promise((function(r,n){t=Gt({onFailedAttempt:function(){},retries:10},t);var o=At.operation(t);o.attempt((function(i){return __awaiter(d,void 0,void 0,(function(){var s,a,u;return __generator(this,(function(c){switch(c.label){case 0:c.trys.push([0,2,,10]);s=r;return[4,e(i)];case 1:s.apply(void 0,[c.sent()]);return[3,10];case 2:a=c.sent();if(!(a instanceof Error)){n(new TypeError('Non-error was thrown: "'+a+'". You should only throw errors.'));return[2]}if(!(a instanceof Ct))return[3,3];o.stop();n(a.originalError);return[3,9];case 3:if(!(a instanceof TypeError))return[3,4];o.stop();n(a);return[3,9];case 4:jt(a,i,t);c.label=5;case 5:c.trys.push([5,7,,8]);return[4,t.onFailedAttempt(a)];case 6:c.sent();return[3,8];case 7:u=c.sent();n(u);return[2];case 8:if(!o.retry(a)){n(o.mainError())}c.label=9;case 9:return[3,10];case 10:return[2]}}))}))}))}))};var $t=Pt;var Rt=Pt;var Dt=Ct;$t.default=Rt;$t.AbortError=Dt;function Ot(e,t){return"executa.stenci.la+1+"+e+(t!==undefined?"+"+t:"")}function kt(e){return e.readyState===De.OPEN}function It(e){return e.readyState===De.CLOSING||e.readyState===De.CLOSED}function Nt(e,t){if(t===void 0){t=60}if(It(e))throw new Error("WebSocket is closing or closed");if(e.readyState!==De.OPEN){return new Promise((function(r,n){var o=false;e.onopen=function(){o=true;r()};setTimeout((function(){if(!o)n(new Error("WebSocket timeout"))}),t*1e3)}))}return Promise.resolve()}function Lt(e,t,r){if(r===void 0){r=60}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,Nt(e,r)];case 1:n.sent();e.send(t);return[2,Promise.resolve()]}}))}))}var qt=Ke("executa:ws:client");var Ut={logging:true,timeout:60,retries:10};var Mt=function(e){__extends(t,e);function t(t,r){if(t===void 0){t=new pt}if(r===void 0){r=Ut}var n=e.call(this,"ws")||this;n.stopped=false;n.address=new pt(t);n.options=Gt(Gt({},Ut),r);return n}t.prototype.start=function(){var e=this;var t=this,r=t.id,n=t.address,o=t.options,i=o.retries,s=o.logging;var a=this.socket=new De(n.url(),Ot(r,n.jwt));a.onmessage=function(t){return e.receive(t.data.toString())};a.onclose=function(t){if(e.stopped===true)return;var r=t.code,n=t.reason;if(r===4001){if(s)qt.error("Failed to authenticate with server: "+n);return}if(i>0){if(s)qt.info("Connection closed, trying to reconnect");$t((function(){return e.start()}),{retries:i,randomize:true}).catch((function(e){return qt.error(e)}))}};a.onerror=function(e){if(s)qt.error(e.message)};this.stopped=false;return Promise.resolve()};t.prototype.send=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n;return __generator(this,(function(o){switch(o.label){case 0:t=this,r=t.socket,n=t.options.timeout;if(!(r===undefined))return[3,2];return[4,this.start()];case 1:o.sent();return[2,this.send(e)];case 2:return[2,Lt(r,JSON.stringify(e),n)]}}))}))};t.prototype.receive=function(t){var r=this,n=r.socket,o=r.options.logging;if(n===undefined)return;if(kt(n))e.prototype.receive.call(this,t);else if(o)qt.warn("Message received while socket was closing: "+t)};t.prototype.stop=function(){this.stopped=true;if(this.socket!==undefined)this.socket.close();return Promise.resolve()};t.discover=function(){qt.warn("Discovery not available for WebSocket client");return Promise.resolve([])};return t}(_t);function Ft(e){return e.length===0}function Bt(e,t){return e<0||e>=t.length}function zt(e,t){return t===undefined?function(t){return zt(e,t)}:Bt(e,t)?R:D(t[e])}var Jt=Ft;var Ht=zt;var Wt=o((function(e,t){(function(t,r){if(typeof s==="function"&&"object"==="object"&&"object"==="object"){e.exports=r()}else{t.pluralize=r()}})(i,(function(){var e=[];var t=[];var r={};var n={};var o={};function i(e){if(typeof e==="string"){return new RegExp("^"+e+"$","i")}return e}function s(e,t){if(e===t)return t;if(e===e.toLowerCase())return t.toLowerCase();if(e===e.toUpperCase())return t.toUpperCase();if(e[0]===e[0].toUpperCase()){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}return t.toLowerCase()}function a(e,t){return e.replace(/\$(\d{1,2})/g,(function(e,r){return t[r]||""}))}function u(e,t){return e.replace(t[0],(function(r,n){var o=a(t[1],arguments);if(r===""){return s(e[n-1],o)}return s(r,o)}))}function c(e,t,n){if(!e.length||r.hasOwnProperty(e)){return t}var o=n.length;while(o--){var i=n[o];if(i[0].test(t))return u(t,i)}return t}function f(e,t,r){return function(n){var o=n.toLowerCase();if(t.hasOwnProperty(o)){return s(n,o)}if(e.hasOwnProperty(o)){return s(n,e[o])}return c(o,n,r)}}function l(e,t,r,n){return function(n){var o=n.toLowerCase();if(t.hasOwnProperty(o))return true;if(e.hasOwnProperty(o))return false;return c(o,o,r)===o}}function h(e,t,r){var n=t===1?h.singular(e):h.plural(e);return(r?t+" ":"")+n}h.plural=f(o,n,e);h.isPlural=l(o,n,e);h.singular=f(n,o,t);h.isSingular=l(n,o,t);h.addPluralRule=function(t,r){e.push([i(t),r])};h.addSingularRule=function(e,r){t.push([i(e),r])};h.addUncountableRule=function(e){if(typeof e==="string"){r[e.toLowerCase()]=true;return}h.addPluralRule(e,"$0");h.addSingularRule(e,"$0")};h.addIrregularRule=function(e,t){t=t.toLowerCase();e=e.toLowerCase();o[e]=t;n[t]=e};[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach((function(e){return h.addIrregularRule(e[0],e[1])}));[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach((function(e){return h.addPluralRule(e[0],e[1])}));[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach((function(e){return h.addSingularRule(e[0],e[1])}));["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[eé]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(h.addUncountableRule);return h}))}));var Gt=undefined&&undefined.__assign||function(){Gt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return Gt.apply(this,arguments)};var Vt=undefined&&undefined.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};var Kt=function(e,t,r){if(r===void 0){r=false}if(!e||!t||typeof e!=="object"||typeof t!=="object")return e;var n=Gt({},e);for(var o in t){if(t.hasOwnProperty(o)){if(t[o]instanceof Array&&e[o]instanceof Array){n[o]=r?Vt(e[o],t[o]):t[o]}else if(typeof t[o]==="object"&&typeof e[o]==="object"){n[o]=Kt(e[o],t[o],r)}else{n[o]=t[o]}}}return n};var Yt=undefined&&undefined.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};var Xt={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(e,t){var r=t===void 0?{}:t,n=r.doThrow,o=n===void 0?true:n,i=r.instance,s=i===void 0?false:i;var a=[];for(var u=2;u<arguments.length;u++){a[u-2]=arguments[u]}var c=this.polyfills[e]||(typeof self!=="undefined"?self[e]:null)||(typeof global!=="undefined"?global[e]:null);if(o&&!c)throw new Error(e+" is not defined");return s&&c?new(c.bind.apply(c,Yt([void 0],a))):c}};var Qt=function(e,t,r,n){if(!e.getEntriesByName)return false;var o=e.getEntriesByName(t);if(o&&o.length>0){r(o.reverse()[0]);if(n.clearMeasures)n.clearMeasures(t);er.callbacks.delete(t);if(er.callbacks.size<1){er.observer.disconnect();if(n.clearResourceTimings){n.clearResourceTimings()}}return true}return false};var Zt=function(e,t){if(!er.observer&&e&&t){er.observer=new t((function(t){er.callbacks.forEach((function(r,n){Qt(t,n,r,e)}))}));if(e.clearResourceTimings)e.clearResourceTimings()}return er.observer};var er={callbacks:new Map,observer:null,observe:function(e,t){if(!e||!t)return;var r=Xt.polyfill("performance",{doThrow:false});var n=Xt.polyfill("PerformanceObserver",{doThrow:false});if(!Zt(r,n))return;if(!Qt(r,e,t,r)){if(er.callbacks.size<1)er.observer.observe({entryTypes:["resource","measure"]});er.callbacks.set(e,t)}}};var tr=function(e){return function(t){return e.length===0?t:e.length===1?e[0](t):e.reduceRight((function(r,n,o){return o===e.length-2?n(r(t)):n(r)}))}};var rr=function(){function e(e){this.error=e}return e}();var nr=function(e){var t=e._url,r=e._catchers,n=e._resolvers,o=e._middlewares,i=e._options;var s=new Map(r);var a=Kt(Xt.defaults,i);var u=Xt.polyfill("AbortController",{doThrow:false,instance:true});if(!a["signal"]&&u){a["signal"]=u.signal}var c={ref:null,clear:function(){if(c.ref){clearTimeout(c.ref);c.ref=null}}};var f=tr(o)(Xt.polyfill("fetch"))(t,a);var l=f.catch((function(e){throw new rr(e)})).then((function(e){c.clear();if(!e.ok){return e[Xt.errorType||"text"]().then((function(t){var r=new Error(t);r[Xt.errorType||"text"]=t;r["status"]=e.status;r["response"]=e;throw r}))}return e}));var h=function(t){return t.catch((function(t){c.clear();var r=t instanceof rr?t.error:t;if(t instanceof rr&&s.has("__fromFetch"))return s.get("__fromFetch")(r,e);else if(s.has(r.status))return s.get(r.status)(r,e);else if(s.has(r.name))return s.get(r.name)(r,e);else throw r}))};var d=function(e){return function(t){return e?h(l.then((function(t){return t&&t[e]()})).then((function(e){return t?t(e):e}))):h(l.then((function(e){return t?t(e):e})))}};var p={res:d(null),json:d("json"),blob:d("blob"),formData:d("formData"),arrayBuffer:d("arrayBuffer"),text:d("text"),perfs:function(e){f.then((function(t){return er.observe(t.url,e)}));return p},setTimeout:function(e,t){if(t===void 0){t=u}c.clear();c.ref=setTimeout((function(){return t.abort()}),e);return p},controller:function(){return[u,p]},error:function(e,t){s.set(e,t);return p},badRequest:function(e){return p.error(400,e)},unauthorized:function(e){return p.error(401,e)},forbidden:function(e){return p.error(403,e)},notFound:function(e){return p.error(404,e)},timeout:function(e){return p.error(408,e)},internalError:function(e){return p.error(500,e)},fetchError:function(e){return p.error("__fromFetch",e)},onAbort:function(e){return p.error("AbortError",e)}};return n.reduce((function(t,r){return r(t,e)}),p)};var or=undefined&&undefined.__assign||function(){or=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return or.apply(this,arguments)};var ir=undefined&&undefined.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};var sr="application/json";var ar="Content-Type";var ur=function(){function e(e,t,r,n,o,i){if(r===void 0){r=new Map}if(n===void 0){n=[]}if(o===void 0){o=[]}if(i===void 0){i=[]}this._url=e;this._options=t;this._catchers=r;this._resolvers=n;this._middlewares=o;this._deferredChain=i}e.factory=function(t,r){if(t===void 0){t=""}if(r===void 0){r={}}return new e(t,r)};e.prototype.selfFactory=function(t){var r=t===void 0?{}:t,n=r.url,o=n===void 0?this._url:n,i=r.options,s=i===void 0?this._options:i,a=r.catchers,u=a===void 0?this._catchers:a,c=r.resolvers,f=c===void 0?this._resolvers:c,l=r.middlewares,h=l===void 0?this._middlewares:l,d=r.deferredChain,p=d===void 0?this._deferredChain:d;return new e(o,or({},s),new Map(u),ir(f),ir(h),ir(p))};e.prototype.defaults=function(e,t){if(t===void 0){t=false}Xt.defaults=t?Kt(Xt.defaults,e):e;return this};e.prototype.errorType=function(e){Xt.errorType=e;return this};e.prototype.polyfills=function(e){Xt.polyfills=or(or({},Xt.polyfills),e);return this};e.prototype.url=function(e,t){if(t===void 0){t=false}if(t)return this.selfFactory({url:e});var r=this._url.split("?");return this.selfFactory({url:r.length>1?r[0]+e+"?"+r[1]:this._url+e})};e.prototype.options=function(e,t){if(t===void 0){t=true}return this.selfFactory({options:t?Kt(this._options,e):e})};e.prototype.query=function(e,t){if(t===void 0){t=false}return this.selfFactory({url:cr(this._url,e,t)})};e.prototype.headers=function(e){return this.selfFactory({options:Kt(this._options,{headers:e||{}})})};e.prototype.accept=function(e){return this.headers({Accept:e})};e.prototype.content=function(e){var t;return this.headers((t={},t[ar]=e,t))};e.prototype.auth=function(e){return this.headers({Authorization:e})};e.prototype.catcher=function(e,t){var r=new Map(this._catchers);r.set(e,t);return this.selfFactory({catchers:r})};e.prototype.signal=function(e){return this.selfFactory({options:or(or({},this._options),{signal:e.signal})})};e.prototype.resolve=function(e,t){if(t===void 0){t=false}return this.selfFactory({resolvers:t?[e]:ir(this._resolvers,[e])})};e.prototype.defer=function(e,t){if(t===void 0){t=false}return this.selfFactory({deferredChain:t?[e]:ir(this._deferredChain,[e])})};e.prototype.middlewares=function(e,t){if(t===void 0){t=false}return this.selfFactory({middlewares:t?e:ir(this._middlewares,e)})};e.prototype.method=function(e,t,r){if(t===void 0){t={}}if(r===void 0){r=null}var n=this._options.headers;var o=!r?this:typeof r==="object"&&(!n||Object.entries(n).every((function(e){var t=e[0],r=e[1];return t.toLowerCase()!==ar.toLowerCase()||r===sr})))?this.json(r):this.body(r);o=o.options(or(or({},t),{method:e}));var i=o._deferredChain.reduce((function(e,t){return t(e,e._url,e._options)}),o);return nr(i)};e.prototype.get=function(e){return this.method("GET",e)};e.prototype.delete=function(e){return this.method("DELETE",e)};e.prototype.put=function(e,t){return this.method("PUT",t,e)};e.prototype.post=function(e,t){return this.method("POST",t,e)};e.prototype.patch=function(e,t){return this.method("PATCH",t,e)};e.prototype.head=function(e){return this.method("HEAD",e)};e.prototype.opts=function(e){return this.method("OPTIONS",e)};e.prototype.replay=function(e){return this.method(this._options.method,e)};e.prototype.body=function(e){return this.selfFactory({options:or(or({},this._options),{body:e})})};e.prototype.json=function(e){return this.content(sr).body(JSON.stringify(e))};e.prototype.formData=function(e,t){if(t===void 0){t=false}return this.body(fr(e,t))};e.prototype.formUrl=function(e){return this.body(typeof e==="string"?e:hr(e)).content("application/x-www-form-urlencoded")};return e}();var cr=function(e,t,r){var n;if(typeof t==="string"){n=t}else{var o=Xt.polyfill("URLSearchParams",{instance:true});for(var i in t){if(t[i]instanceof Array){for(var s=0,a=t[i];s<a.length;s++){var u=a[s];o.append(i,u)}}else{o.append(i,t[i])}}n=o.toString()}var c=e.split("?");if(r||c.length<2)return c[0]+"?"+n;return e+"&"+n};function fr(e,t,r,n){if(t===void 0){t=false}if(r===void 0){r=Xt.polyfill("FormData",{instance:true})}if(n===void 0){n=[]}Object.entries(e).forEach((function(e){var o=e[0],i=e[1];var s=n.reduce((function(e,t){return e?e+"["+t+"]":t}),null);s=s?s+"["+o+"]":o;if(i instanceof Array){for(var a=0,u=i;a<u.length;a++){var c=u[a];r.append(s+"[]",c)}}else if(t&&typeof i==="object"&&(!(t instanceof Array)||!t.includes(o))){if(i!==null){fr(i,t,r,ir(n,[o]))}}else{r.append(s,i)}}));return r}function lr(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(typeof t==="object"?JSON.stringify(t):""+t)}function hr(e){return Object.keys(e).map((function(t){var r=e[t];if(r instanceof Array){return r.map((function(e){return lr(t,e)})).join("&")}return lr(t,r)})).join("&")}var dr=ur.factory;dr["default"]=ur.factory;var pr;(function(e){e["WAITING"]="WAITING";e["DISPATCHED"]="DISPATCHED";e["PENDING"]="PENDING";e["RECEIVED"]="RECEIVED";e["STARTED"]="STARTED";e["SUCCESS"]="SUCCESS";e["FAILURE"]="FAILURE";e["CANCELLED"]="CANCELLED";e["REVOKED"]="REVOKED";e["TERMINATED"]="TERMINATED";e["RUNNING"]="RUNNING"})(pr||(pr={}));var vr={keepChecking:[pr.WAITING,pr.DISPATCHED,pr.PENDING,pr.RECEIVED,pr.STARTED],stopChecking:[pr.SUCCESS,pr.FAILURE,pr.CANCELLED,pr.REVOKED,pr.TERMINATED],readyToExecute:[pr.RUNNING]};var mr=function(e){return!(e instanceof Error)};var yr=function(e){return e.url!==null&&vr.readyToExecute.includes(e.status)};var br=function(e){return vr.stopChecking.includes(e.status)};var gr=function(e){if(vr.stopChecking.includes(e.status)){return we(e)}else if(vr.readyToExecute.includes(e.status)){return yr(e)?ge(e):we(e)}return je(br(e)?we(e):ge(e))};var wr=dr().options({credentials:"include"});var _r=function(e){return wr.url(e).get().json((function(e){return e}))};var xr=function(e){return e===undefined?Promise.resolve(we(new Error("No Job Url to connect to"))):h.pipe(e,(function(e){return __awaiter(d,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,_r(e)];case 1:t=r.sent();return[2,gr(t)]}}))}))}))};var Er=function(e){return mr(e)?e.statusMessage:"An unexpected error occurred"};var Sr=function(e){return h.pipe(e,Pe((function(){return"Requesting session"}),(function(){return"Requesting session"}),Er,(function(e){return e.statusMessage}),Er,(function(e){return e.statusMessage})))};var Tr=function(e,r){var n=e.session,o=e.job;return t("span",{class:{executableDocumentStatus:true,danger:Ae(n),success:Te(n)}},h.pipe(n,Pe((function(){return""}),(function(){return t("span",null,t("stencila-icon",{icon:"loader-2"}),t("span",null,Sr(o)))}),(function(e){return t("span",null,t("stencila-icon",{icon:"loader-2"}),t("span",null,Er(e)))}),(function(e){return t("span",null,Jt(r)?[t("stencila-icon",{icon:"loader-2"}),e.status]:t("span",null,r))}),(function(e){return t("span",null,t("stencila-icon",{icon:"error-warning"}),t("span",null,Er(e)))}),(function(){return t("stencila-tooltip",{text:"Compute session is active"},t("stencila-icon",{icon:"pulse"}),Jt(r)?null:t("span",null,r))}))))};var Ar=":host,stencila-executable-document-toolbar{--background:var(--color-neutral-300);display:block}:host([position=fixed]),stencila-executable-document-toolbar[position=fixed]{position:fixed;top:0;left:0;z-index:30;width:100%;max-width:none!important}:host([position=fixed])+*,stencila-executable-document-toolbar[position=fixed]+*{margin-top:3rem}:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:none}@media (min-width:640px){:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:inline}}:host .executableDocumentStatus,stencila-executable-document-toolbar .executableDocumentStatus{font-size:.875rem;line-height:1;color:#000;color:var(--color-key,#000)}:host .executableDocumentStatus.success,stencila-executable-document-toolbar .executableDocumentStatus.success{color:#2f855a;color:var(--color-success-700,#2f855a)}:host .executableDocumentStatus.danger,stencila-executable-document-toolbar .executableDocumentStatus.danger{color:#f56565;color:var(--color-danger-500,#f56565)}:host .executableDocumentStatus stencila-icon,stencila-executable-document-toolbar .executableDocumentStatus stencila-icon{margin-right:.25rem}:host .executableDocumentStatus stencila-tooltip,stencila-executable-document-toolbar .executableDocumentStatus stencila-tooltip{cursor:help}:host .executableDocumentStatus span,stencila-executable-document-toolbar .executableDocumentStatus span{vertical-align:middle}";var Cr=":host,stencila-executable-document-toolbar{--background:var(--color-neutral-300);display:block}:host([position=fixed]),stencila-executable-document-toolbar[position=fixed]{position:fixed;top:0;left:0;z-index:30;width:100%;max-width:none!important}:host([position=fixed])+*,stencila-executable-document-toolbar[position=fixed]+*{margin-top:3rem}:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:none}@media (min-width:640px){:host .hidden-sm,stencila-executable-document-toolbar .hidden-sm{display:inline}}:host .executableDocumentStatus,stencila-executable-document-toolbar .executableDocumentStatus{font-size:.875rem;line-height:1;color:#000;color:var(--color-key,#000)}:host .executableDocumentStatus.success,stencila-executable-document-toolbar .executableDocumentStatus.success{color:#2f855a;color:var(--color-success-700,#2f855a)}:host .executableDocumentStatus.danger,stencila-executable-document-toolbar .executableDocumentStatus.danger{color:#f56565;color:var(--color-danger-500,#f56565)}:host .executableDocumentStatus stencila-icon,stencila-executable-document-toolbar .executableDocumentStatus stencila-icon{margin-right:.25rem}:host .executableDocumentStatus stencila-tooltip,stencila-executable-document-toolbar .executableDocumentStatus stencila-tooltip{cursor:help}:host .executableDocumentStatus span,stencila-executable-document-toolbar .executableDocumentStatus span{vertical-align:middle}";var jr=u({position:c.topCenter});var Pr=function(){return jr.present("Couldn’t start a compute session",{type:a.danger})};var $r=e("stencila_executable_document_toolbar",function(){function e(e){var n=this;r(this,e);this.jobPoller=undefined;this.jobPollFrequency=3e3;this.requestController=new AbortController;this.requestSignal=this.requestController.signal;this.initAbortControllers=function(){n.requestController=new AbortController;n.requestSignal=n.requestController.signal};this.position="fixed";this.session=_e;this.job=_e;this.executor=null;this.codeCount=0;this.statusMessage="";this.checkJobStatus=function(){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(e){if(H(this.job)){return[2,this.job]}else{this.job=Ce(this.job);return[2,xr(this.jobUrl)]}return[2]}))}))};this.handleJobStatus=function(e,t,r){return h.pipe(e,Pe((function(){n.jobPoller=n.pollJobFn(n.jobPollFrequency,t,r);return xe}),(function(){return e}),(function(){return e}),(function(){return e}),(function(t){var r;window.clearInterval(n.jobPoller);n.requestController.abort();(r=n.executor)===null||r===void 0?void 0:r.stop().catch((function(e){console.warn("Failed to stop Executa",e)}));n.session=we(t);return e}),(function(r){if(yr(r)){window.clearInterval(n.jobPoller);n.jobPoller=n.pollJobFn(1e4);if(t){t(n.startExecutor(r.url))}}return e})),(function(e){n.job=e;return e}))};this.pollJob=function(e,t){return n.checkJobStatus().then((function(r){return n.handleJobStatus(r,e,t)})).catch((function(e){return n.handleJobStatus(we(e))}))};this.pollJobFn=function(e,t,r){if(e===void 0){e=n.jobPollFrequency}return window.setInterval((function(){n.pollJob(t,r).catch((function(e){return we(e)}))}),e)};this.findSession=function(){return __awaiter(n,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){if(this.sessionProviderUrl===undefined){return[2,we(new Error("Please set a SessionProviderUrl"))]}if(z(this.session)||Ae(this.session)){this.session=xe;return[2,wr.url(this.sessionProviderUrl).post().res((function(t){e.jobUrl=t.url})).then((function(){return new Promise((function(t,r){return e.handleJobStatus(_e,t,r)}))})).catch((function(t){Pr();e.session=we(t);throw t}))]}return[2,Promise.resolve(this.session)]}))}))};this.startExecutor=function(e){return __awaiter(n,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:t=new Mt(e);this.executor=t;r=this;return[4,t.begin(f()).then((function(e){jr.present("Ready to run document",{type:a.success});return ge(e)})).catch((function(e){Pr();return we(new Error(e))}))];case 1:r.session=n.sent();return[2,this.session]}}))}))};this.codeNodeSelector=function(){return Vt(Array.from(document.querySelectorAll("stencila-code-chunk, stencila-code-expression")))};this.executeHandler=function(e){return __awaiter(n,void 0,void 0,(function(){var t;var r=this;return __generator(this,(function(n){if(J(this.session)){jr.present("Please wait until a compute session is found",{type:a.warn});return[2,e]}t=function(t){var r;return Object.assign(Object.assign({},e),{errors:Vt((r=e.errors)!==null&&r!==void 0?r:[],[l({errorType:"error",errorMessage:"Could not run "+(e.type==="CodeChunk"?"code chunk":"code expression"),stackTrace:t})])})};return[2,this.findSession().then((function(){if(r.executor&&Te(r.session)){return r.executor.execute(e,r.session.value.right).catch((function(e){console.error(e);return t(e)}))}return t("Couldn’t start a compute session")})).catch((function(e){return t(e)}))]}))}))};this.runAll=function(e){return __awaiter(n,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){e.preventDefault();this.initAbortControllers();return[2,new Promise((function(e,r){t.requestSignal.addEventListener("abort",r);t.findSession().then((function(){return __awaiter(t,void 0,void 0,(function(){var t,n,o,i,s,a;return __generator(this,(function(u){switch(u.label){case 0:t=[];n=0;this.session=Ce(this.session);o=0,i=this.codeNodeSelector();u.label=1;case 1:if(!(o<i.length))return[3,4];s=i[o];this.activeNodeIndex=n;this.statusMessage=++n+" of "+this.codeCount+" code "+Wt("node",this.codeCount);return[4,s.execute()];case 2:a=u.sent();t.push(a);if(n>=this.codeCount){this.statusMessage=""}u.label=3;case 3:o++;return[3,1];case 4:this.session=je(this.session);this.requestSignal.removeEventListener("abort",r);return[2,e(t)]}}))}))})).catch((function(e){t.requestSignal.removeEventListener("abort",r);r(e)}))}))]}))}))};this.goToActiveNode=function(){var e;h.pipe(n.codeNodeSelector(),Ht((e=n.activeNodeIndex)!==null&&e!==void 0?e:-1),k((function(e){var t;var r=document.querySelector("stencila-executable-document-toolbar");var n=(t=r===null||r===void 0?void 0:r.getBoundingClientRect().height)!==null&&t!==void 0?t:0;var o=e.getBoundingClientRect().top-n+window.pageYOffset;window.scrollTo({top:o,behavior:"smooth"})})))};this.executionProgress=function(){return t("stencila-tooltip",{text:"Jump to location",onClick:n.goToActiveNode},t("stencila-icon",{icon:"focus-3"}),t("span",null,n.statusMessage))}}e.prototype.componentWillLoad=function(){var e=this;var t=this.codeNodeSelector();this.codeCount=t.length;t.map((function(t){t.executeHandler=e.executeHandler}))};e.prototype.render=function(){return t(n,{position:this.position},t("stencila-toolbar",null,t("span",{slot:"start"},t("stencila-button",{color:"stock",icon:"play",size:"small",onClick:this.runAll,disabled:this.codeCount<=0,tooltip:this.codeCount<=0?"No code nodes in the document to execute":undefined,isLoading:J(this.session)||H(this.session),dataEl:"Toolbar/Run Document"},J(this.session)||H(this.session)?"Running":["Run",t("span",{class:"hidden-sm"}," Document")])),t("span",{slot:"middle"},t(Tr,{job:this.job,session:this.session},H(this.session)&&this.executionProgress())),this.sourceUrl!==undefined&&t("span",{slot:"end"},t("stencila-button",{color:"stock",href:this.sourceUrl,target:"_blank",rel:"nofollow noopener",icon:"external-link",size:"small",dataEl:"Toolbar/Project Source"},"Source"))))};return e}());$r.style={default:Ar,material:Cr}}}}));