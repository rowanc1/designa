var __awaiter=this&&this.__awaiter||function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,c){function a(e){try{s(n.next(e))}catch(t){c(t)}}function r(e){try{s(n["throw"](e))}catch(t){c(t)}}function s(e){e.done?i(e.value):o(e.value).then(a,r)}s((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var i={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,o,c,a;return a={next:r(0),throw:r(1),return:r(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function r(e){return function(t){return s([e,t])}}function s(a){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,o&&(c=a[0]&2?o["return"]:a[0]?o["throw"]||((c=o["return"])&&c.call(o),0):o.next)&&!(c=c.call(o,a[1])).done)return c;if(o=0,c)a=[a[0]&2,c.value];switch(a[0]){case 0:case 1:c=a;break;case 4:i.label++;return{value:a[1],done:false};case 5:i.label++;o=a[1];a=[0];continue;case 7:a=i.ops.pop();i.trys.pop();continue;default:if(!(c=i.trys,c=c.length>0&&c[c.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!c||a[1]>c[0]&&a[1]<c[3])){i.label=a[1];break}if(a[0]===6&&i.label<c[1]){i.label=c[1];c=a;break}if(c&&i.label<c[2]){i.label=c[2];i.ops.push(a);break}if(c[2])i.ops.pop();i.trys.pop();continue}a=t.call(e,i)}catch(r){a=[6,r];o=0}finally{n=c=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,H as Host,a as getElement}from"./index-9edcbeb0.js";import{l}from"./schema-ceac4a12.js";var defaultCodeChunkCss="*.sc-stencila-code-chunk-default,.sc-stencila-code-chunk-default:after,.sc-stencila-code-chunk-default:before{-webkit-box-sizing:border-box;box-sizing:border-box;border:0 solid}html.sc-stencila-code-chunk-default{font-size:16px}.hidden.sc-stencila-code-chunk-default{display:none}code.sc-stencila-code-chunk-default,code[class*=language-].sc-stencila-code-chunk-default,output.sc-stencila-code-chunk-default{font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:75%}pre.sc-stencila-code-chunk-default{border:1px solid #e2e8f0;border-color:var(--color-neutral-300,#e2e8f0);border-radius:.25rem;padding:.5rem;margin:.5rem;overflow:auto}.preReset.sc-stencila-code-chunk-default{padding:0;margin:0;border-width:0}.sc-stencila-code-chunk-default-h,stencila-code-chunk.sc-stencila-code-chunk-default{--background:var(--color-stock,#fff);--background-editor:var(--color-neutral-200,#edf2f7);--border:var(--color-neutral-300,#e2e8f0);position:relative;display:block;width:100%;margin-top:1rem;margin-bottom:1rem;overflow:hidden;border-width:1px;border-style:solid;border-radius:.25rem;border-color:var(--border)}.sc-stencila-code-chunk-default-h stencila-action-menu.sc-stencila-code-chunk-default,stencila-code-chunk.sc-stencila-code-chunk-default stencila-action-menu.sc-stencila-code-chunk-default{position:relative;display:block;width:100%;padding:0;border-left-width:0;border-right-width:0;border-radius:0}.sc-stencila-code-chunk-default-h stencila-editor.sc-stencila-code-chunk-default,stencila-code-chunk.sc-stencila-code-chunk-default stencila-editor.sc-stencila-code-chunk-default{--border-width:0;-ms-flex-positive:1;flex-grow:1}.sc-stencila-code-chunk-default-h stencila-node-list.sc-stencila-code-chunk-default,stencila-code-chunk.sc-stencila-code-chunk-default stencila-node-list.sc-stencila-code-chunk-default{padding:.5rem;margin:0;background-color:var(--background)}.editorContainer.sc-stencila-code-chunk-default{position:relative;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex:1 1 auto;flex:1 1 auto;margin:0;border-width:0 0 1px;border-radius:0;background:var(--background-editor);border-color:var(--border);height:intrinsic}.editorContainer.sc-stencila-code-chunk-default pre.sc-stencila-code-chunk-default,.editorContainer.sc-stencila-code-chunk-default pre[class*=language-].sc-stencila-code-chunk-default{background-color:transparent}.editorContainer.hidden.sc-stencila-code-chunk-default{display:none}@media (min-width:1024px){.sc-stencila-code-chunk-default-h>div.sc-stencila-code-chunk-default,stencila-code-chunk.sc-stencila-code-chunk-default>div.sc-stencila-code-chunk-default{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:stretch;align-items:stretch;width:100%}.editorContainer.sc-stencila-code-chunk-default{width:50%;border-bottom-width:0;border-right-width:1px}stencila-node-list.sc-stencila-code-chunk-default{-ms-flex-positive:1;flex-grow:1;width:50%}}";var codeChunkMaterialCss="*.sc-stencila-code-chunk-material,.sc-stencila-code-chunk-material:after,.sc-stencila-code-chunk-material:before{-webkit-box-sizing:border-box;box-sizing:border-box;border:0 solid}html.sc-stencila-code-chunk-material{font-size:16px}.hidden.sc-stencila-code-chunk-material{display:none}code.sc-stencila-code-chunk-material,code[class*=language-].sc-stencila-code-chunk-material,output.sc-stencila-code-chunk-material{font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:75%}pre.sc-stencila-code-chunk-material{border:1px solid #e2e8f0;border-color:var(--color-neutral-300,#e2e8f0);border-radius:.25rem;padding:.5rem;margin:.5rem;overflow:auto}.preReset.sc-stencila-code-chunk-material{padding:0;margin:0;border-width:0}.sc-stencila-code-chunk-material-h,stencila-code-chunk.sc-stencila-code-chunk-material{--background:var(--color-stock,#fff);--background-editor:var(--color-neutral-200,#edf2f7);--border:var(--color-neutral-300,#e2e8f0);position:relative;display:block;width:100%;margin-top:1rem;margin-bottom:1rem;overflow:hidden;border-width:1px;border-style:solid;border-radius:.25rem;border-color:var(--border)}.sc-stencila-code-chunk-material-h stencila-action-menu.sc-stencila-code-chunk-material,stencila-code-chunk.sc-stencila-code-chunk-material stencila-action-menu.sc-stencila-code-chunk-material{position:relative;display:block;width:100%;padding:0;border-left-width:0;border-right-width:0;border-radius:0}.sc-stencila-code-chunk-material-h stencila-editor.sc-stencila-code-chunk-material,stencila-code-chunk.sc-stencila-code-chunk-material stencila-editor.sc-stencila-code-chunk-material{--border-width:0;-ms-flex-positive:1;flex-grow:1}.sc-stencila-code-chunk-material-h stencila-node-list.sc-stencila-code-chunk-material,stencila-code-chunk.sc-stencila-code-chunk-material stencila-node-list.sc-stencila-code-chunk-material{padding:.5rem;margin:0;background-color:var(--background)}.editorContainer.sc-stencila-code-chunk-material{position:relative;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex:1 1 auto;flex:1 1 auto;margin:0;border-width:0 0 1px;border-radius:0;background:var(--background-editor);border-color:var(--border);height:intrinsic}.editorContainer.sc-stencila-code-chunk-material pre.sc-stencila-code-chunk-material,.editorContainer.sc-stencila-code-chunk-material pre[class*=language-].sc-stencila-code-chunk-material{background-color:transparent}.editorContainer.hidden.sc-stencila-code-chunk-material{display:none}@media (min-width:1024px){.sc-stencila-code-chunk-material-h>div.sc-stencila-code-chunk-material,stencila-code-chunk.sc-stencila-code-chunk-material>div.sc-stencila-code-chunk-material{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:stretch;align-items:stretch;width:100%}.editorContainer.sc-stencila-code-chunk-material{width:50%;border-bottom-width:0;border-right-width:1px}stencila-node-list.sc-stencila-code-chunk-material{-ms-flex-positive:1;flex-grow:1;width:50%}}";var CodeChunkComponent=function(){function e(e){var t=this;registerInstance(this,e);this.setAllCodeVisibility=createEvent(this,"setAllCodeVisibility",7);this.autofocus=false;this.isCodeCollapsed=false;this.isCodeVisible=false;this.keymap=[];this.executeCodeState="INITIAL";this.isCodeVisibleState=this.isCodeVisible;this.toggleCodeVisibility=function(e){if(e.shiftKey){t.toggleAllCodeVisibility()}else{t.isCodeVisibleState=!t.isCodeVisibleState}};this.toggleAllCodeVisibility=function(){return t.setAllCodeVisibilityHandler(!t.isCodeVisibleState)};this.onExecuteHandler=function(){return __awaiter(t,void 0,void 0,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:this.executeCodeState="PENDING";return[4,this.getContents()];case 1:e=i.sent();if(!(this.executeHandler!==undefined))return[3,3];return[4,this.executeHandler(e)];case 2:t=i.sent();this.executeCodeState="RESOLVED";this.updateErrors(t.errors);this.outputs=t.outputs;return[2,t];case 3:this.executeCodeState="RESOLVED";return[2,e]}}))}))};this.executeRef=function(){return t.execute()};this.updateErrors=function(e){if(e===void 0){e=[]}t.codeErrors=e.map((function(e){return h("stencila-code-error",{kind:e.errorType,hasStacktrace:e.stackTrace!==undefined},e.errorMessage,h("pre",{slot:"stacktrace"},e.stackTrace))}))};this.setCodeVisibility=function(e){var i;t.isCodeVisibleState=(i=e.detail.isVisible)!==null&&i!==void 0?i:e.detail.isCodeCollapsed}}e.prototype.onSetAllCodeVisibility=function(e){this.setCodeVisibility(e)};e.prototype.componentDidLoad=function(){this.editorRef=this.el.querySelector("stencila-editor")};e.prototype.getContents=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,i,n;return __generator(this,(function(o){switch(o.label){case 0:if(!this.editorRef)return[3,2];return[4,(e=this.editorRef)===null||e===void 0?void 0:e.getContents()];case 1:t=o.sent(),i=t.text,n=t.language;return[2,l({text:i,programmingLanguage:n})];case 2:return[2,l({text:""})]}}))}))};e.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;var i=this;return __generator(this,(function(n){switch(n.label){case 0:this.executeCodeState="PENDING";n.label=1;case 1:n.trys.push([1,3,,4]);return[4,this.onExecuteHandler()];case 2:e=n.sent();window.setTimeout((function(){return i.executeCodeState="RESOLVED"}),250);return[2,e];case 3:t=n.sent();console.error(t);this.executeCodeState="RESOLVED";return[2,t];case 4:return[2]}}))}))};e.prototype.setAllCodeVisibilityHandler=function(e){this.setAllCodeVisibility.emit({isVisible:e})};e.prototype.render=function(){return h(Host,{class:{isCodeVisible:this.isCodeVisibleState}},h("stencila-action-menu",{expandable:true},this.executeHandler!==undefined&&h("stencila-button",{icon:"play",minimal:true,color:"key",class:"run",size:"xsmall",tooltip:"Run",iconOnly:true,slot:"persistentActions",onClick:this.executeRef,isLoading:this.executeCodeState==="PENDING"}),h("stencila-button",{minimal:true,color:"key",class:"sourceToggle",onClick:this.toggleCodeVisibility,icon:this.isCodeVisibleState?"eye-off":"eye",iconOnly:true,size:"xsmall",slot:"persistentActions",tooltip:(this.isCodeVisibleState?"Hide":"Show")+" Code"})),h("div",null,h("div",{class:{editorContainer:true,hidden:!this.isCodeVisibleState}},h("stencila-editor",{activeLanguage:this.programmingLanguageProp,autofocus:this.autofocus,executeHandler:this.onExecuteHandler,keymap:this.keymap,readOnly:this.executeHandler===undefined},h("slot",{name:CodeChunkComponent.slots.text}))),h("stencila-node-list",{nodes:this.outputs},h("slot",{name:CodeChunkComponent.slots.outputs}),this.codeErrors)))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();CodeChunkComponent.slots={text:"text",outputs:"outputs"};CodeChunkComponent.style={default:defaultCodeChunkCss,material:codeChunkMaterialCss};export{CodeChunkComponent as stencila_code_chunk};